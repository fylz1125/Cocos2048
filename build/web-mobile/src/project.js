window.__require=function e(t,r,o){function s(n,c){if(!r[n]){if(!t[n]){var a=n.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+n+"'")}}var u=r[n]={exports:{}};t[n][0].call(u.exports,function(e){return s(t[n][1][e]||e)},u,u.exports,e,t,r,o)}return r[n].exports}for(var i="function"==typeof __require&&__require,n=0;n<o.length;n++)s(o[n]);return s}({GameController:[function(e,t,r){"use strict";cc._RF.push(t,"6cc80kdg9RKsL7X9y2WeBEQ","GameController");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./Core/GameCore"),i=e("./NumberSprite"),n=e("./Core/Location"),c=e("./ResourceManager"),a=e("./Core/MoveDirection"),h=e("./GameResult"),{ccclass:u,property:l}=cc._decorator;let f=class extends cc.Component{constructor(){super(...arguments),this.bestScore=null,this.currentScore=null,this.resultPage=null,this.gameResult=null,this.resManager=null,this.core=null,this.numberSprites=[],this.touchStart=null,this.slideThreshold=50,this._isRunning=!1}onLoad(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.handleKeyDown,this),this.node.on(cc.Node.EventType.TOUCH_START,this.handleTouchEvent,this),this.node.on(cc.Node.EventType.TOUCH_END,this.handleTouchEvent,this),this.node.once("gameOver",this.onGameOver,this)}start(){this.resManager=this.getComponent(c.default),this.core=new s.default,this.resManager.ready(()=>{this.int(),this.generateNumber(),this.generateNumber()})}onDestroy(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.handleKeyDown),this.node.off(cc.Node.EventType.TOUCH_START,this.handleTouchEvent,this),this.node.off(cc.Node.EventType.TOUCH_END,this.handleTouchEvent,this)}restart(){this.currentScore.string=0,this.clearNumbers(),this.core.reset(),this.generateNumber(),this.generateNumber(),this.resultPage.getComponent(h.default).hide(),this.node.once("gameOver",this.onGameOver,this),this._isRunning=!0}onGameOver(e=!1){this._isRunning=!1,this.resultPage.getComponent(h.default).show(e)}int(){this._isRunning=!0;for(let e=0;e<4;e++){const t=[];for(let r=0;r<4;r++)t.push(this.createSprite(new n.default(e,r)));this.numberSprites.push(t)}}clearNumbers(){this.numberSprites.forEach(e=>e.forEach(e=>e.setImage(0)))}handleKeyDown(e){switch(e.keyCode){case a.default.Up:case a.default.Down:case a.default.Left:case a.default.Right:this.core.move(e.keyCode)}}handleTouchEvent(e){if("touchstart"===e.type)this.touchStart=e.touch.getLocation();else{const t=e.touch.getLocation().sub(this.touchStart);Math.abs(t.x)>Math.abs(t.y)&&t.mag()>this.slideThreshold?t.x>0?this.core.move(a.default.Right):this.core.move(a.default.Left):t.mag()>this.slideThreshold&&(t.y>0?this.core.move(a.default.Up):this.core.move(a.default.Down))}}createSprite(e){const t=new cc.Node;t.name=`${e.rIndex}${e.cIndex}`,t.addComponent(cc.Sprite),t.setParent(this.node);const r=t.addComponent(i.default);return r.resManager=this.resManager,r.setImage(0),r}generateNumber(){const{num:e,location:t}=this.core.generateNumber();if(e<0)return;const r=this.numberSprites[t.rIndex][t.cIndex];r.node.scale=.6,r.setImage(e),r.enterEffect()}updateMap(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)this.numberSprites[e][t].setImage(this.core.map.getNumber(new n.default(e,t)))}update(e){this._isRunning&&(this.core.isChange&&(this.playEffect(),this.updateMap(),this.generateNumber(),this.core.isChange=!1,this.core.bestScore>parseInt(this.bestScore.string)&&(this.bestScore.string=this.core.bestScore),this.core.currentScore>parseInt(this.currentScore.string)&&(this.currentScore.string=this.core.currentScore)),this.core.isOver&&this.node.emit("gameOver",this.core.isSuccess))}playEffect(){this.core.changedLocations.forEach(e=>{this.numberSprites[e.rIndex][e.cIndex].mergeEffect()}),this.core.changedLocations=[]}};o([l(cc.Label)],f.prototype,"bestScore",void 0),o([l(cc.Label)],f.prototype,"currentScore",void 0),o([l(cc.Node)],f.prototype,"resultPage",void 0),o([l(h.default)],f.prototype,"gameResult",void 0),f=o([u],f),r.default=f,cc._RF.pop()},{"./Core/GameCore":"GameCore","./Core/Location":"Location","./Core/MoveDirection":"MoveDirection","./GameResult":"GameResult","./NumberSprite":"NumberSprite","./ResourceManager":"ResourceManager"}],GameCore:[function(e,t,r){"use strict";cc._RF.push(t,"41788UeKhlDGqpkeP1BQVeA","GameCore"),Object.defineProperty(r,"__esModule",{value:!0});const o=e("./Matrix"),s=e("./MoveDirection"),i=e("./Location");r.default=class{constructor(){this.mergeArray=[],this.zeroFilterArray=[],this.emptyLocations=[],this.successThreshold=2048,this.rowLen=4,this.colLen=4,this._isChange=!1,this._isOver=!1,this._isSuccess=!1,this.bestScore=0,this.currentScore=0,this.changedLocations=[],this.moveInfo=[],this.moveSteps=[],this._map=new o.default(4,4),this.originalMap=new o.default(4,4)}get map(){return this._map}get isChange(){return this._isChange}set isChange(e){this._isChange=e}get isOver(){return this._isOver}get isSuccess(){return this._isSuccess}removeZero(e=!1){this.zeroFilterArray=new Array(this.rowLen),o.default.fill(this.zeroFilterArray);let t=0,r=0;for(let o=0,s=this.mergeArray.length;o<s;o++)0===this.mergeArray[o]?r++:(e?this.moveInfo.push({idx:o,tempIdx:t,count:r}):r&&this.updateMoveInfo({tempIdx:o,count:r}),this.zeroFilterArray[t++]=this.mergeArray[o]);this.mergeArray=this.zeroFilterArray}merge(){const e=[];this.removeZero(!0);for(let t=0,r=this.mergeArray.length;t<r;t++)this.mergeArray[t]&&this.mergeArray[t]===this.mergeArray[t+1]&&(this.mergeArray[t]+=this.mergeArray[t],this.mergeArray[t+1]=0,e.push(t),this.updateMoveInfo({tempIdx:t+1,count:1},!0),this.mergeArray[t]>this.currentScore&&(this.currentScore=this.mergeArray[t]),this.currentScore>this.bestScore&&(this.bestScore=this.currentScore));return this.removeZero(),this.moveInfo=this.moveInfo.filter(e=>!!e.count),e}updateMoveInfo(e,t=!1){this.moveInfo.forEach(r=>{r.tempIdx===e.tempIdx&&(r.count+=e.count,t&&(r.tempIdx-=1))})}moveUp(){for(let e=0;e<this.colLen;e++){this.moveInfo=[],this.mergeArray=this._map.getColNumbers(e);const t=this.merge();this.changedLocations.push(...t.map(t=>new i.default(t,e))),this.moveInfo.forEach(t=>{this.moveSteps.push({from:new i.default(t.idx,e),to:new i.default(t.idx-t.count,e)})}),this._map.setColNumbers(e,this.mergeArray)}}moveDown(){for(let e=0;e<this.colLen;e++){this.moveInfo=[],this.mergeArray=this._map.getColNumbers(e).reverse();const t=this.merge();this.changedLocations.push(...t.map(t=>new i.default(this.rowLen-t-1,e))),this.moveInfo.forEach(t=>{this.moveSteps.push({from:new i.default(this.colLen-t.idx-1,e),to:new i.default(this.colLen-t.idx-1+t.count,e)})}),this._map.setColNumbers(e,this.mergeArray.reverse())}}moveLeft(){for(let e=0;e<this.rowLen;e++){this.moveInfo=[],this.mergeArray=this._map.getRowNumbers(e);const t=this.merge();this.changedLocations.push(...t.map(t=>new i.default(e,t))),this.moveInfo.forEach(t=>{this.moveSteps.push({from:new i.default(e,t.idx),to:new i.default(e,t.idx-t.count)})}),this._map.setRowNumbers(e,this.mergeArray)}}moveRight(){for(let e=0;e<this.rowLen;e++){this.moveInfo=[],this.mergeArray=this._map.getRowNumbers(e).reverse();const t=this.merge();this.changedLocations.push(...t.map(t=>new i.default(e,this.colLen-t-1))),this.moveInfo.forEach(t=>{this.moveSteps.push({from:new i.default(e,this.rowLen-t.idx-1),to:new i.default(e,this.rowLen-t.idx-1+t.count)})}),this._map.setRowNumbers(e,this.mergeArray.reverse())}}move(e){if(!this._isOver){switch(this.originalMap=this._map.clone(),this._isChange=!1,this.moveInfo=[],this.moveSteps=[],e){case s.default.Up:this.moveUp();break;case s.default.Down:this.moveDown();break;case s.default.Left:this.moveLeft();break;case s.default.Right:this.moveRight()}this._isChange=this._map.isChange(this.originalMap),this.checkOver()&&(this._isOver=!0)}}generateNumber(){if(this.emptyLocations=this._map.getEmptyLocations(),this.emptyLocations.length&&!this._isOver){const e=Math.floor(Math.random()*this.emptyLocations.length),t=this.emptyLocations[e],r=1===Math.ceil(10*Math.random())?4:2;return this._map.setNumber(t,r),this.emptyLocations.splice(e,1),{num:r,location:t}}return{num:-1,location:new i.default(-1,-1)}}checkOver(){if(this.currentScore>=this.successThreshold)return this._isSuccess=!0,!0;if(this.emptyLocations.length)return!1;for(let e=0;e<this.rowLen;e++)for(let t=0;t<this.colLen-1;t++)if(this._map.getNumber(new i.default(e,t))===this._map.getNumber(new i.default(e,t+1))||this._map.getNumber(new i.default(t,e))===this._map.getNumber(new i.default(t+1,e)))return!1;return!0}reset(){this._isOver=!1,this.currentScore=0,this._map=new o.default(4,4)}},cc._RF.pop()},{"./Location":"Location","./Matrix":"Matrix","./MoveDirection":"MoveDirection"}],GameResult:[function(e,t,r){"use strict";cc._RF.push(t,"f978cZAMgJKG7bsfk7f/W4o","GameResult");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.resultTitle=null,this.descTitle=null}show(e=!1){e?(this.resultTitle.string="Congratulation!",this.descTitle.string="You Win"):(this.resultTitle.string="Game Over!",this.descTitle.string="Try Again"),this.node.opacity=0;const t=cc.moveBy(.5,0,874.75).easing(cc.easeInOut(5)),r=cc.fadeTo(.5,255);this.node.runAction(cc.spawn(t,r))}hide(){const e=cc.moveBy(.5,0,-874.75).easing(cc.easeInOut(5)),t=cc.fadeTo(0,255);this.node.runAction(cc.spawn(e,t))}};o([i(cc.Label)],n.prototype,"resultTitle",void 0),o([i(cc.Label)],n.prototype,"descTitle",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],Location:[function(e,t,r){"use strict";cc._RF.push(t,"1e6e4P55XBI26bP5/f5sKG3","Location"),Object.defineProperty(r,"__esModule",{value:!0});var o=function(){return function(e,t){this.rIndex=null,this.cIndex=null,this.rIndex=e,this.cIndex=t}}();r.default=o,cc._RF.pop()},{}],Matrix:[function(e,t,r){"use strict";cc._RF.push(t,"b041f9keahJZJGjucZ/hHmc","Matrix"),Object.defineProperty(r,"__esModule",{value:!0});var o=e("./Location"),s=function(){function e(e,t){this.matrix=[],this.row=e,this.col=t,this.init()}return e.fill=function(e,t){void 0===t&&(t=0);for(var r=0,o=e.length;r<o;r++)e[r]=t},e.prototype.init=function(){for(var t=0;t<this.row;t++){var r=new Array(this.col);e.fill(r),this.matrix.push(r)}},e.prototype.setNumber=function(e,t){this.matrix[e.rIndex][e.cIndex]=t},e.prototype.getNumber=function(e){return this.matrix[e.rIndex][e.cIndex]},e.prototype.getRowNumbers=function(e){return this.matrix[e]},e.prototype.setRowNumbers=function(e,t){this.matrix[e]=t},e.prototype.getColNumbers=function(e){return this.matrix.map(function(t){return t[e]})},e.prototype.setColNumbers=function(e,t){this.matrix.forEach(function(r,o){return r[e]=t[o]})},e.prototype.clone=function(){for(var t=new e(this.row,this.col),r=0;r<this.row;r++)t.setRowNumbers(r,this.getRowNumbers(r).slice());return t},e.prototype.getEmptyLocations=function(){for(var e=[],t=0;t<this.row;t++)for(var r=0;r<this.col;r++)0===this.matrix[t][r]&&e.push(new o.default(t,r));return e},e.prototype.isChange=function(e){for(var t=0;t<this.row;t++)for(var r=0;r<this.col;r++)if(this.matrix[t][r]!==e.getNumber(new o.default(t,r)))return!0;return!1},e}();r.default=s,cc._RF.pop()},{"./Location":"Location"}],MoveDirection:[function(e,t,r){"use strict";var o;cc._RF.push(t,"82158ded4tM342NeSK1zX8X","MoveDirection"),Object.defineProperty(r,"__esModule",{value:!0}),function(e){e[e.Up=38]="Up",e[e.Down=40]="Down",e[e.Left=37]="Left",e[e.Right=39]="Right"}(o||(o={})),r.default=o,cc._RF.pop()},{}],NumberSprite:[function(e,t,r){"use strict";cc._RF.push(t,"444dfy/KjlPZYxr6kNMPWWv","NumberSprite");var o=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});const{ccclass:s,property:i}=cc._decorator;let n=class extends cc.Component{constructor(){super(...arguments),this.sp=null,this.resManager=null,this.duration=.08}onLoad(){this.sp=this.node.getComponent(cc.Sprite)}setImage(e){this.sp.spriteFrame=this.resManager.getImage(e),this.sp.node.width=112.5,this.sp.node.height=112.5}enterEffect(){const e=cc.scaleTo(0,.6),t=cc.scaleTo(2*this.duration,1).easing(cc.easeIn(3));this.node.runAction(cc.sequence(e,t))}mergeEffect(){const e=cc.scaleTo(this.duration,1.15).easing(cc.easeCubicActionOut()),t=cc.scaleTo(this.duration,1).easing(cc.easeCubicActionIn());this.node.runAction(cc.sequence(e,t))}moveEffect(e){}};o([i],n.prototype,"duration",void 0),n=o([s],n),r.default=n,cc._RF.pop()},{}],ResourceManager:[function(e,t,r){"use strict";cc._RF.push(t,"0efbd3iARdBurBa2XEyoXxf","ResourceManager");var o=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(r,"__esModule",{value:!0});var i=cc._decorator.ccclass,n=["0","2","4","8","16","32","64","128","256","512","1024","2048","4096","8192"],c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.map={},t.handlers=[],t}return o(t,e),t.prototype.onLoad=function(){var e=this;cc.loader.loadRes("Texture/2048",cc.SpriteAtlas,function(t,r){if(t)return console.error(t);n.forEach(function(t){e.map[t]=r.getSpriteFrame(t)}),e.handlers.length&&(e.handlers.forEach(function(e){return e(r)}),e.handlers=[])})},t.prototype.ready=function(e){this.handlers.push(e)},t.prototype.getImage=function(e){return this.map[e+""]},t=s([i],t)}(cc.Component);r.default=c,cc._RF.pop()},{}]},{},["GameCore","Location","Matrix","MoveDirection","GameController","GameResult","NumberSprite","ResourceManager"]);