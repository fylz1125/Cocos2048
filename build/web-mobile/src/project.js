window.__require=function e(t,r,o){function n(c,s){if(!r[c]){if(!t[c]){var a=c.split("/");if(a=a[a.length-1],!t[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}}var h=r[c]={exports:{}};t[c][0].call(h.exports,function(e){return n(t[c][1][e]||e)},h,h.exports,e,t,r,o)}return r[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<o.length;c++)n(o[c]);return n}({GameController:[function(e,t,r){"use strict";cc._RF.push(t,"6cc80kdg9RKsL7X9y2WeBEQ","GameController");var o=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c};Object.defineProperty(r,"__esModule",{value:!0});var i=e("./Core/GameCore"),c=e("./NumberSprite"),s=e("./Core/Location"),a=e("./ResourceManager"),u=e("./Core/MoveDirection"),h=cc._decorator,p=h.ccclass,f=h.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bestScore=null,t.currentScore=null,t.resManager=null,t.core=null,t.numberSprites=[],t.touchStart=null,t.slideThreshold=50,t}return o(t,e),t.prototype.onLoad=function(){cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.handleKeyDown,this),this.node.on(cc.Node.EventType.TOUCH_START,this.handleTouchEvent,this),this.node.on(cc.Node.EventType.TOUCH_END,this.handleTouchEvent,this)},t.prototype.start=function(){var e=this;this.resManager=this.getComponent(a.default),this.core=new i.default,this.resManager.ready(function(){e.int(),e.generateNumber(),e.generateNumber()})},t.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.handleKeyDown),this.node.off(cc.Node.EventType.TOUCH_START,this.handleTouchEvent,this),this.node.off(cc.Node.EventType.TOUCH_END,this.handleTouchEvent,this)},t.prototype.restart=function(){this.currentScore.string=0,this.clearNumbers(),this.core.reset(),this.int(),this.generateNumber(),this.generateNumber()},t.prototype.int=function(){for(var e=0;e<4;e++){for(var t=[],r=0;r<4;r++)t.push(this.createSprite(new s.default(e,r)));this.numberSprites.push(t)}},t.prototype.clearNumbers=function(){this.numberSprites.forEach(function(e){return e.forEach(function(e){return e.setImage(0)})})},t.prototype.handleKeyDown=function(e){switch(e.keyCode){case u.default.Up:case u.default.Down:case u.default.Left:case u.default.Right:this.core.move(e.keyCode)}},t.prototype.handleTouchEvent=function(e){if("touchstart"===e.type)this.touchStart=e.touch.getLocation();else{var t=e.touch.getLocation().sub(this.touchStart);Math.abs(t.x)>Math.abs(t.y)&&t.mag()>this.slideThreshold?t.x>0?this.core.move(u.default.Right):this.core.move(u.default.Left):t.mag()>this.slideThreshold&&(t.y>0?this.core.move(u.default.Up):this.core.move(u.default.Down))}},t.prototype.createSprite=function(e){var t=new cc.Node;t.name=""+e.rIndex+e.cIndex;t.addComponent(cc.Sprite);t.setParent(this.node);var r=t.addComponent(c.default);return r.resManager=this.resManager,r.setImage(0),r},t.prototype.generateNumber=function(){var e=this.core.generateNumber(),t=e.num,r=e.location;this.numberSprites[r.rIndex][r.cIndex].setImage(t)},t.prototype.updateMap=function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.numberSprites[e][t].setImage(this.core.map.getNumber(new s.default(e,t)))},t.prototype.update=function(e){this.core.isChange&&!this.core.isOver&&(this.updateMap(),this.playEffect(),this.generateNumber(),this.core.isChange=!1,this.core.bestScore>parseInt(this.bestScore.string)&&(this.bestScore.string=this.core.bestScore),this.core.currentScore>parseInt(this.currentScore.string)&&(this.currentScore.string=this.core.currentScore))},t.prototype.playEffect=function(){var e=this;this.core.changedLocations.forEach(function(t){e.numberSprites[t.rIndex][t.cIndex].createEffect()}),this.core.changedLocations=[]},n([f(cc.Label)],t.prototype,"bestScore",void 0),n([f(cc.Label)],t.prototype,"currentScore",void 0),t=n([p],t)}(cc.Component);r.default=l,cc._RF.pop()},{"./Core/GameCore":"GameCore","./Core/Location":"Location","./Core/MoveDirection":"MoveDirection","./NumberSprite":"NumberSprite","./ResourceManager":"ResourceManager"}],GameCore:[function(e,t,r){"use strict";cc._RF.push(t,"41788UeKhlDGqpkeP1BQVeA","GameCore"),Object.defineProperty(r,"__esModule",{value:!0});var o=e("./Matrix"),n=e("./MoveDirection"),i=e("./Location"),c=function(){function e(){this.mergeArray=[],this.zeroFilterArray=[],this.emptyLocations=[],this.rowLen=4,this.colLen=4,this._isChange=!1,this._isOver=!1,this.bestScore=0,this.currentScore=0,this.changedLocations=[],this._map=new o.default(4,4),this.originalMap=new o.default(4,4)}return Object.defineProperty(e.prototype,"map",{get:function(){return this._map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChange",{get:function(){return this._isChange},set:function(e){this._isChange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOver",{get:function(){return this._isOver},enumerable:!0,configurable:!0}),e.prototype.removeZero=function(){this.zeroFilterArray=new Array(this.rowLen),o.default.fill(this.zeroFilterArray);for(var e=0,t=0,r=this.mergeArray.length;t<r;t++)0!==this.mergeArray[t]&&(this.zeroFilterArray[e++]=this.mergeArray[t]);this.mergeArray=this.zeroFilterArray},e.prototype.merge=function(){var e=[];this.removeZero();for(var t=0,r=this.mergeArray.length;t<r;t++)this.mergeArray[t]&&this.mergeArray[t]===this.mergeArray[t+1]&&(this.mergeArray[t]+=this.mergeArray[t],this.mergeArray[t+1]=0,e.push(t),this.mergeArray[t]>this.currentScore&&(this.currentScore=this.mergeArray[t]),this.currentScore>this.bestScore&&(this.bestScore=this.currentScore));return this.removeZero(),e},e.prototype.moveUp=function(){for(var e=function(e){var r;t.mergeArray=t._map.getColNumbers(e);var o=t.merge();(r=t.changedLocations).push.apply(r,o.map(function(t){return new i.default(t,e)})),t._map.setColNumbers(e,t.mergeArray)},t=this,r=0;r<this.colLen;r++)e(r)},e.prototype.moveDown=function(){for(var e=this,t=function(t){var o;r.mergeArray=r._map.getColNumbers(t).reverse();var n=r.merge();(o=r.changedLocations).push.apply(o,n.map(function(r){return new i.default(e.rowLen-r-1,t)})),r._map.setColNumbers(t,r.mergeArray.reverse())},r=this,o=0;o<this.colLen;o++)t(o)},e.prototype.moveLeft=function(){for(var e=function(e){var r;t.mergeArray=t._map.getRowNumbers(e);var o=t.merge();(r=t.changedLocations).push.apply(r,o.map(function(t){return new i.default(e,t)})),t._map.setRowNumbers(e,t.mergeArray)},t=this,r=0;r<this.rowLen;r++)e(r)},e.prototype.moveRight=function(){for(var e=this,t=function(t){var o;r.mergeArray=r._map.getRowNumbers(t).reverse();var n=r.merge();(o=r.changedLocations).push.apply(o,n.map(function(r){return new i.default(t,e.colLen-r-1)})),r._map.setRowNumbers(t,r.mergeArray.reverse())},r=this,o=0;o<this.rowLen;o++)t(o)},e.prototype.move=function(e){switch(this.originalMap=this._map.clone(),this._isChange=!1,e){case n.default.Up:this.moveUp();break;case n.default.Down:this.moveDown();break;case n.default.Left:this.moveLeft();break;case n.default.Right:this.moveRight()}this._isChange=this._map.isChange(this.originalMap),this.checkOver()&&(this._isOver=!0)},e.prototype.generateNumber=function(){if(this.emptyLocations=this._map.getEmptyLocations(),this.emptyLocations.length){var e=Math.floor(Math.random()*this.emptyLocations.length),t=this.emptyLocations[e],r=1===Math.ceil(10*Math.random())?4:2;return this._map.setNumber(t,r),this.emptyLocations.splice(e,1),{num:r,location:t}}return{num:-1,location:new i.default(-1,-1)}},e.prototype.checkOver=function(){if(this.emptyLocations.length)return!1;for(var e=0;e<this.rowLen;e++)for(var t=0;t<this.colLen-1;t++)if(this._map.getNumber(new i.default(e,t))===this._map.getNumber(new i.default(e,t+1))||this._map.getNumber(new i.default(t,e))===this._map.getNumber(new i.default(t+1,e)))return!1;return!0},e.prototype.reset=function(){this._isOver=!1,this.currentScore=0,this._map=new o.default(4,4)},e}();r.default=c,cc._RF.pop()},{"./Location":"Location","./Matrix":"Matrix","./MoveDirection":"MoveDirection"}],Location:[function(e,t,r){"use strict";cc._RF.push(t,"1e6e4P55XBI26bP5/f5sKG3","Location"),Object.defineProperty(r,"__esModule",{value:!0});var o=function(){return function(e,t){this.rIndex=null,this.cIndex=null,this.rIndex=e,this.cIndex=t}}();r.default=o,cc._RF.pop()},{}],Matrix:[function(e,t,r){"use strict";cc._RF.push(t,"b041f9keahJZJGjucZ/hHmc","Matrix"),Object.defineProperty(r,"__esModule",{value:!0});var o=e("./Location"),n=function(){function e(e,t){this.matrix=[],this.row=e,this.col=t,this.init()}return e.fill=function(e,t){void 0===t&&(t=0);for(var r=0,o=e.length;r<o;r++)e[r]=t},e.prototype.init=function(){for(var t=0;t<this.row;t++){var r=new Array(this.col);e.fill(r),this.matrix.push(r)}},e.prototype.setNumber=function(e,t){this.matrix[e.rIndex][e.cIndex]=t},e.prototype.getNumber=function(e){return this.matrix[e.rIndex][e.cIndex]},e.prototype.getRowNumbers=function(e){return this.matrix[e]},e.prototype.setRowNumbers=function(e,t){this.matrix[e]=t},e.prototype.getColNumbers=function(e){return this.matrix.map(function(t){return t[e]})},e.prototype.setColNumbers=function(e,t){this.matrix.forEach(function(r,o){return r[e]=t[o]})},e.prototype.clone=function(){for(var t=new e(this.row,this.col),r=0;r<this.row;r++)t.setRowNumbers(r,this.getRowNumbers(r).slice());return t},e.prototype.getEmptyLocations=function(){for(var e=[],t=0;t<this.row;t++)for(var r=0;r<this.col;r++)0===this.matrix[t][r]&&e.push(new o.default(t,r));return e},e.prototype.isChange=function(e){for(var t=0;t<this.row;t++)for(var r=0;r<this.col;r++)if(this.matrix[t][r]!==e.getNumber(new o.default(t,r)))return!0;return!1},e}();r.default=n,cc._RF.pop()},{"./Location":"Location"}],MoveDirection:[function(e,t,r){"use strict";var o;cc._RF.push(t,"82158ded4tM342NeSK1zX8X","MoveDirection"),Object.defineProperty(r,"__esModule",{value:!0}),function(e){e[e.Up=38]="Up",e[e.Down=40]="Down",e[e.Left=37]="Left",e[e.Right=39]="Right"}(o||(o={})),r.default=o,cc._RF.pop()},{}],NumberSprite:[function(e,t,r){"use strict";cc._RF.push(t,"444dfy/KjlPZYxr6kNMPWWv","NumberSprite");var o=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c};Object.defineProperty(r,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,s=i.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sp=null,t.resManager=null,t.duration=.08,t}return o(t,e),t.prototype.onLoad=function(){this.sp=this.node.getComponent(cc.Sprite)},t.prototype.setImage=function(e){this.sp.spriteFrame=this.resManager.getImage(e),this.sp.node.width=112.5,this.sp.node.height=112.5},t.prototype.createEffect=function(){var e=cc.scaleTo(this.duration,1.15).easing(cc.easeCubicActionOut()),t=cc.scaleTo(this.duration,1).easing(cc.easeCubicActionIn());this.node.runAction(cc.sequence(e,t))},n([s],t.prototype,"duration",void 0),t=n([c],t)}(cc.Component);r.default=a,cc._RF.pop()},{}],ResourceManager:[function(e,t,r){"use strict";cc._RF.push(t,"0efbd3iARdBurBa2XEyoXxf","ResourceManager");var o=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}(),n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,r,c):n(t,r))||c);return i>3&&c&&Object.defineProperty(t,r,c),c};Object.defineProperty(r,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=["0","2","4","8","16","32","64","128","256","512","1024","2048","4096","8192"],s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.map={},t.handlers=[],t}return o(t,e),t.prototype.onLoad=function(){var e=this;cc.loader.loadRes("Texture/2048",cc.SpriteAtlas,function(t,r){if(t)return console.error(t);c.forEach(function(t){e.map[t]=r.getSpriteFrame(t)}),e.handlers.length&&(e.handlers.forEach(function(e){return e(r)}),e.handlers=[])})},t.prototype.ready=function(e){this.handlers.push(e)},t.prototype.getImage=function(e){return this.map[e+""]},t=n([i],t)}(cc.Component);r.default=s,cc._RF.pop()},{}]},{},["GameCore","Location","Matrix","MoveDirection","GameController","NumberSprite","ResourceManager"]);